(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{560:function(e,t,a){Promise.resolve().then(a.bind(a,1710))},1710:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var s=a(7437),r=a(2265),l=a(8746),n=a(8872);a(2392);var i=a(3390),o=a(263),d=a(4364),c=a(9854),u=a(9842),m=a(3908);let h=(0,c.cF)(),x=m.db,g=async(e,t,a,s,r)=>{if(!e||!e.name)throw Error("Le fichier est invalide ou manquant.");let l="".concat("image"===t?"images":"videos","/").concat(e.name,"_").concat(Date.now()),n=(0,c.iH)(h,l),i=(0,c.B0)(n,e);return new Promise((l,n)=>{i.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);r&&r(t)},e=>{n(e)},async()=>{let r=await (0,c.Jt)(i.snapshot.ref);await (0,u.ET)((0,u.hJ)(x,"files"),{name:e.name,url:r,type:t,tags:a,addBy:s.id,createdAt:new Date}),l(r)})})},f=m.db,b=async(e,t,a)=>{let s=(0,u.JU)(f,"tags",e),r=await (0,u.QT)(s);if(r.exists()){let e=r.data();await (0,u.pl)(s,{...e,totalFiles:e.totalFiles+1,lastAddedFileUrl:t},{merge:!0})}else{await (0,u.pl)(s,{name:e,totalFiles:1,lastAddedFileUrl:t,createdBy:a.id,createdAt:new Date});let r=(0,u.JU)(f,"users",a.id),l=await (0,u.QT)(r);if(l.exists()){let t=l.data().createdTags||[];t.push(e),await (0,u.r7)(r,{createdTags:t})}}};var p=a(7453);let w=async(e,t)=>{let a=(0,u.JU)(m.db,"users",e),s=await (0,u.QT)(a);if(s.exists()){let e=s.data(),r=(e.totalFileUploads||0)+1,l=e.recentFiles||[];l.unshift(t),l.length>3&&(l=l.slice(0,3)),await (0,u.r7)(a,{totalFileUploads:r,recentFiles:l})}else throw Error("Utilisateur non trouv\xe9")};var v=a(8786),j=a(2126),y=e=>{let{text:t,onRemove:a}=e;return(0,s.jsxs)("span",{className:"bg-greenPrimary text-white px-4 py-2 rounded-lg mr-2 mb-2 font-body flex items-center",children:[t,(0,s.jsx)("button",{onClick:a,className:"ml-4 text-black hover:text-red-500 text-2xl font-bold focus:outline-none",children:"\xd7"})]})},N=(0,o.Z)(()=>{let[e,t]=(0,r.useState)([]),[a,o]=(0,r.useState)(""),[c,u]=(0,r.useState)([]),[m,h]=(0,r.useState)(0),[x,f]=(0,r.useState)(!1),[N,k]=(0,r.useState)(!1),[F,U]=(0,r.useState)(0),{user:E}=(0,p.a)(),{tags:C}=(0,v.e)(),A=a=>{if(""===a.trim())return;let s=[...e];s[m].tags=(0,d.Pn)(s[m].tags,a),t(s),o(""),u([])},P=a=>{let s=[...e];s[m].tags=s[m].tags.filter(e=>e!==a),t(s)},{getRootProps:_,getInputProps:D}=(0,l.uI)({onDrop:e=>{let a=e.map(e=>({id:e.name+Date.now(),file:e,preview:URL.createObjectURL(e),tags:[]}));t(e=>[...e,...a]),f(!1)},onDragEnter:()=>f(!0),onDragLeave:()=>f(!1)}),S=async()=>{k(!0),U(0);try{let a=e[m],s=g(a.file,a.file.type.startsWith("image")?"image":"video",a.tags,E,e=>U(e)),r=await s;for(let e of a.tags)await b(e,r,E);await w(null==E?void 0:E.id,r),(0,j.XA)(),m+1<e.length?h(m+1):(t([]),h(0)),o(""),U(100)}catch(e){console.error("Erreur lors de l'upload :",e),(0,j.Eo)("Erreur lors de l'upload")}finally{k(!1)}};return(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"bg-dark1 min-h-screen p-8 pb-32 lg:pb-8 ",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-white mb-6 font-title lg:ml-0 ml-6",children:"Ajouter un M\xe9dia"}),(0,s.jsxs)("div",{..._(),className:"border-2 border-dashed p-8 rounded-md flex justify-center items-center cursor-pointer transition-colors duration-200 ".concat(x?"border-greenPrimary bg-dark3":"border-gray-500 bg-dark2"),children:[(0,s.jsx)("input",{...D()}),(0,s.jsx)("p",{className:"text-gray-400 font-body",children:"Glissez et d\xe9posez des fichiers ici, ou cliquez pour s\xe9lectionner"})]}),e.length>0&&(0,s.jsxs)("div",{className:"mt-6 max-w-lg mx-auto",children:[(0,s.jsxs)("div",{className:"text-white mb-4 font-bold font-subtitle text-center",children:[m+1," sur ",e.length]}),(0,s.jsxs)("div",{className:"bg-dark2 p-4 rounded-lg shadow-md w-full",children:[e[m].file.type.startsWith("video")?(0,s.jsx)("video",{src:e[m].preview,controls:!0,className:"w-full max-w-[500px] max-h-[400px] h-auto object-contain rounded-md mb-4"}):(0,s.jsx)(n.Z,{children:(0,s.jsx)("img",{src:e[m].preview,alt:"Image active",className:"w-full max-w-[500px] max-h-[400px] h-auto object-contain rounded-md mb-4 cursor-pointer"})}),(0,s.jsx)("div",{className:"text-white font-bold font-subtitle mb-2 text-center",children:e[m].tags.join(" ")})]}),N?(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:(0,s.jsx)("div",{className:"bg-greenPrimary h-2.5 rounded-full",style:{width:"".concat(F,"%")}})}),(0,s.jsxs)("p",{className:"text-center text-white mt-2 font-body",children:[F,"%"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center mt-4 w-full relative",children:[(0,s.jsx)("input",{type:"text",value:a,onChange:e=>{let t=e.target.value.toLowerCase();o(t),t.length>0?u(C.filter(e=>e.toLowerCase().startsWith(t))):u([])},placeholder:"Ajouter un tag",className:"bg-dark3 text-white p-2 rounded-md focus:outline-none font-body w-full mr-2"}),(0,s.jsx)("button",{onClick:()=>A(a),className:"bg-greenPrimary text-white px-3 py-2 rounded-md font-body ".concat(""===a.trim()?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:""===a.trim(),children:"Ajouter"}),c.length>0&&(0,s.jsx)("div",{className:"absolute top-full mt-2 w-full bg-dark3 rounded-md shadow-lg max-h-28 overflow-y-auto z-10",children:c.map(e=>(0,s.jsx)("div",{className:"p-2 hover:bg-dark2 cursor-pointer text-white",onClick:()=>A(e),children:e},e))})]}),(0,s.jsx)("div",{className:"flex flex-wrap mt-4",children:e[m].tags.map((e,t)=>(0,s.jsx)(y,{text:e,onRemove:()=>P(e)},t))}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)("button",{onClick:S,className:"bg-greenPrimary text-white px-4 py-2 rounded-md font-body w-full ".concat(0===e[m].tags.length?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:0===e[m].tags.length,children:"Upload Fichier"})})]})]})]})})})}},function(e){e.O(0,[43,358,691,431,239,437,20,971,23,744],function(){return e(e.s=560)}),_N_E=e.O()}]);