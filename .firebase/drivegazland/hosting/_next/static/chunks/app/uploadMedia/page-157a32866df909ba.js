(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{560:function(e,t,a){Promise.resolve().then(a.bind(a,290))},290:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var s=a(7437),r=a(2265),l=a(8746),n=a(8872);a(2392);var i=a(3390),o=a(263);let d=e=>e.trim().toLowerCase(),c=(e,t)=>{let a=d(t);return e.includes(a)?e:[...e,a]};var u=a(9854),h=a(9842),m=a(3908);let x=(0,u.cF)(),g=m.db,f=async(e,t,a,s,r)=>{if(!e||!e.name)throw Error("Le fichier est invalide ou manquant.");let l="".concat("image"===t?"images":"videos","/").concat(e.name,"_").concat(Date.now()),n=(0,u.iH)(x,l),i=(0,u.B0)(n,e);return new Promise((l,n)=>{i.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);r&&r(t)},e=>{n(e)},async()=>{let r=await (0,u.Jt)(i.snapshot.ref);await (0,h.ET)((0,h.hJ)(g,"files"),{name:e.name,url:r,type:t,tags:a,addBy:s.id,createdAt:new Date}),l(r)})})},p=m.db,v=async(e,t,a)=>{let s=(0,h.JU)(p,"tags",e),r=await (0,h.QT)(s);if(r.exists()){let e=r.data();await (0,h.pl)(s,{...e,totalFiles:e.totalFiles+1,lastAddedFileUrl:t},{merge:!0})}else{await (0,h.pl)(s,{name:e,totalFiles:1,lastAddedFileUrl:t,createdBy:a.id,createdAt:new Date});let r=(0,h.JU)(p,"users",a.id),l=await (0,h.QT)(r);if(l.exists()){let t=l.data().createdTags||[];t.push(e),await (0,h.r7)(r,{createdTags:t})}}};var w=a(7453);let b=async(e,t)=>{let a=(0,h.JU)(m.db,"users",e),s=await (0,h.QT)(a);if(s.exists()){let e=s.data(),r=(e.totalFileUploads||0)+1,l=e.recentFiles||[];l.unshift(t),l.length>3&&(l=l.slice(0,3)),await (0,h.r7)(a,{totalFileUploads:r,recentFiles:l})}else throw Error("Utilisateur non trouv\xe9")};var j=a(8786),y=(0,o.Z)(()=>{let[e,t]=(0,r.useState)([]),[a,o]=(0,r.useState)(""),[d,u]=(0,r.useState)([]),[h,m]=(0,r.useState)(0),[x,g]=(0,r.useState)(!1),[p,y]=(0,r.useState)(!1),[N,k]=(0,r.useState)(0),{user:C}=(0,w.a)(),{tags:E}=(0,j.e)(),P=a=>{if(""===a.trim())return;let s=[...e];s[h].tags=c(s[h].tags,a),t(s),o(""),u([])},S=a=>{let s=[...e];s[h].tags=s[h].tags.filter(e=>e!==a),t(s)},F=async()=>{y(!0),k(0);try{for(let t=0;t<e.length;t++){let a=e[t],s=f(a.file,a.file.type.startsWith("image")?"image":"video",a.tags,C,e=>k(e)),r=await s;for(let e of a.tags)await v(e,r,C);await b(null==C?void 0:C.id,r),console.log("Fichier ".concat(t+1," upload\xe9 avec succ\xe8s !"))}t([]),m(0),o(""),k(100)}catch(e){console.error("Erreur lors de l'upload :",e)}finally{y(!1)}},{getRootProps:U,getInputProps:T}=(0,l.uI)({onDrop:e=>{let a=e.map(e=>({id:e.name+Date.now(),file:e,preview:URL.createObjectURL(e),tags:[]}));t(e=>[...e,...a]),g(!1)},onDragEnter:()=>g(!0),onDragLeave:()=>g(!1)});return(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"bg-dark1 min-h-screen p-8 pb-16 lg:pb-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-white mb-6 font-title lg:ml-0 ml-6",children:"Ajouter un M\xe9dia"}),(0,s.jsxs)("div",{...U(),className:"border-2 border-dashed p-8 rounded-md flex justify-center items-center cursor-pointer transition-colors duration-200 ".concat(x?"border-greenPrimary bg-dark3":"border-gray-500 bg-dark2"),children:[(0,s.jsx)("input",{...T()}),(0,s.jsx)("p",{className:"text-gray-400 font-body",children:"Glissez et d\xe9posez des fichiers ici, ou cliquez pour s\xe9lectionner"})]}),e.length>0&&(0,s.jsxs)("div",{className:"mt-6 max-w-lg mx-auto",children:[(0,s.jsxs)("div",{className:"text-white mb-4 font-bold font-subtitle text-center",children:[h+1," sur ",e.length]}),(0,s.jsxs)("div",{className:"bg-dark2 p-4 rounded-lg shadow-md w-full",children:[e[h].file.type.startsWith("video")?(0,s.jsx)("video",{src:e[h].preview,controls:!0,className:"w-full h-auto object-contain rounded-md mb-4"}):(0,s.jsx)(n.Z,{children:(0,s.jsx)("img",{src:e[h].preview,alt:"Image active",className:"w-full h-auto object-contain rounded-md mb-4 cursor-pointer"})}),(0,s.jsx)("div",{className:"text-white font-bold font-subtitle mb-2 text-center",children:e[h].tags.join(" ")})]}),p?(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:(0,s.jsx)("div",{className:"bg-greenPrimary h-2.5 rounded-full",style:{width:"".concat(N,"%")}})}),(0,s.jsxs)("p",{className:"text-center text-white mt-2 font-body",children:[N,"%"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center mt-4 w-full relative",children:[(0,s.jsx)("input",{type:"text",value:a,onChange:e=>{let t=e.target.value.toLowerCase();o(t),t.length>0?u(E.filter(e=>e.toLowerCase().includes(t))):u([])},placeholder:"Ajouter un tag",className:"bg-dark3 text-white p-2 rounded-md focus:outline-none font-body w-full mr-2"}),(0,s.jsx)("button",{onClick:()=>P(a),className:"bg-greenPrimary text-white px-3 py-2 rounded-md font-body ".concat(""===a.trim()?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:""===a.trim(),children:"Ajouter"}),d.length>0&&(0,s.jsx)("div",{className:"absolute top-full mt-2 w-full bg-dark3 rounded-md shadow-lg max-h-40 overflow-y-auto z-10",children:d.map(e=>(0,s.jsx)("div",{className:"p-2 hover:bg-dark2 cursor-pointer text-white",onClick:()=>P(e),children:e},e))})]}),(0,s.jsx)("div",{className:"flex flex-wrap mt-4",children:e[h].tags.map(e=>(0,s.jsxs)("span",{className:"bg-gray-700 text-white px-2 py-1 rounded-lg mr-2 mb-2 font-body flex items-center",children:[e," ",(0,s.jsx)("button",{onClick:()=>S(e),className:"ml-2 text-redPrimary",children:"\xd7"})]},e))}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)("button",{onClick:F,className:"bg-greenPrimary text-white px-4 py-2 rounded-md font-body w-full ".concat(0===e[h].tags.length?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:0===e[h].tags.length,children:"Upload Fichier"})})]})]})]})})})},8786:function(e,t,a){"use strict";a.d(t,{TagProvider:function(){return o},e:function(){return d}});var s=a(7437),r=a(2265),l=a(9842),n=a(3908);let i=(0,r.createContext)(void 0),o=e=>{let{children:t}=e,[a,o]=(0,r.useState)([]),[d,c]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{try{let e=(0,l.IO)((0,l.hJ)(n.db,"tags"),(0,l.Xo)("name","asc")),t=await (0,l.PL)(e),a=t.docs.map(e=>e.id),s=t.docs.map(e=>({id:e.id,data:e.data()}));o(a),c(s)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des tags :",e)}finally{h(!1)}})()},[]),(0,s.jsx)(i.Provider,{value:{tags:a,tagsWithData:d,loadingTags:u},children:t})},d=()=>{let e=(0,r.useContext)(i);if(void 0===e)throw Error("useTags must be used within a TagProvider");return e}},7453:function(e,t,a){"use strict";a.d(t,{UserProvider:function(){return c},a:function(){return u}});var s=a(7437),r=a(2265),l=a(6463),n=a(3908),i=a(9842),o=a(5186);let d=(0,r.createContext)(void 0),c=e=>{let{children:t}=e,[a,c]=(0,r.useState)(null),[u,h]=(0,r.useState)(!0),m=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=(0,o.Aj)(n.I,async e=>{if(e){let t=(0,i.JU)(n.db,"users",e.uid),a=(0,i.cf)(t,t=>{if(t.exists()){let a={...t.data(),id:e.uid};c(a),a.isValidated||m.push("/account-validation")}else c(null);h(!1)});return()=>a()}c(null),h(!1)});return()=>e()},[m]);let x=async()=>{try{await (0,o.w7)(n.I),c(null),m.push("/")}catch(e){console.error("Erreur lors de la d\xe9connexion :",e)}};return(0,s.jsx)(d.Provider,{value:{user:a,loading:u,logout:x},children:t})},u=()=>{let e=(0,r.useContext)(d);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},3908:function(e,t,a){"use strict";a.d(t,{I:function(){return i},db:function(){return o}});var s=a(5236),r=a(5186),l=a(9842);let n=(0,s.ZF)({apiKey:"AIzaSyA3nabauSNn32rLpKIkT5BoPnH8GYBMgEo",authDomain:"drivegazland.firebaseapp.com",projectId:"drivegazland",storageBucket:"drivegazland.appspot.com",messagingSenderId:"159250775284",appId:"1:159250775284:web:1a9bb56fcbd44938a832a1",measurementId:"G-0TF1NK3MC2"}),i=(0,r.v0)(n),o=(0,l.ad)(n)},3390:function(e,t,a){"use strict";var s=a(7437),r=a(2265),l=a(6648),n=a(4589),i=a(842),o=a(4413),d=a(9651),c=a(6730),u=a(2103),h=a(6463),m=a(7453);t.Z=e=>{let{children:t}=e,[a,x]=(0,r.useState)(!1),g=(0,h.useRouter)(),{logout:f}=(0,m.a)(),p=async()=>{try{await f(),g.push("/")}catch(e){console.error("Erreur lors de la d\xe9connexion\xa0:",e)}},v=()=>{g.push("/profile")},w=()=>{x(!1)};return(0,r.useEffect)(()=>{a?document.body.style.overflow="hidden":document.body.style.overflow="auto"},[a]),(0,s.jsxs)("div",{className:"flex relative",children:[!a&&(0,s.jsx)("button",{className:"lg:hidden fixed top-8 left-4 z-50 text-white",onClick:()=>x(!a),children:(0,s.jsx)(n.Z,{className:"w-8 h-8"})}),a&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30",onClick:w}),(0,s.jsx)("aside",{className:"fixed top-0 left-0 z-40 w-[75%] lg:w-[20%] h-screen bg-dark2 text-white transform ".concat(a?"translate-x-0":"-translate-x-full"," transition-transform duration-300 ease-in-out lg:translate-x-0"),children:(0,s.jsx)("div",{className:"flex flex-col h-full px-4 py-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center justify-center mb-8 md:mb-12",children:(0,s.jsx)(l.default,{src:"/images/GazlandprojetDashboard.png",alt:"Logo",layout:"intrinsic",width:250,height:125,className:"h-6"})}),(0,s.jsxs)("ul",{className:"space-y-2 font-medium",children:[(0,s.jsx)("li",{children:(0,s.jsxs)("a",{href:"/dashboard",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:w,children:[(0,s.jsx)(i.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,s.jsx)("span",{className:"ml-3",children:"Accueil"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)("a",{href:"/ranking",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:()=>{g.push("/ranking")},children:[(0,s.jsx)(o.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,s.jsx)("span",{className:"ml-3",children:"Classement"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)("a",{href:"#",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:()=>{v(),w()},children:[(0,s.jsx)(d.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,s.jsx)("span",{className:"ml-3",children:"Mon Profil"})]})})]}),(0,s.jsxs)("div",{className:"mt-8 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-dark3",children:[(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(c.Z,{className:"w-6 h-6 me-2"}),"Tous les fichiers"]}),(0,s.jsx)("span",{className:"bg-gray-700 text-xs rounded-md px-2 py-1",children:"48"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-dark3",children:[(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(c.Z,{className:"w-6 h-6 me-2"}),"Tous les dossiers"]}),(0,s.jsx)("span",{className:"bg-gray-700 text-xs rounded-md px-2 py-1",children:"6"})]})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)("button",{onClick:p,className:"flex items-center w-full p-2 rounded-lg hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",children:[(0,s.jsx)(u.Z,{className:"w-6 h-6 text-gray-400"}),(0,s.jsx)("span",{className:"ml-3",children:"D\xe9connexion"})]})})]})})}),(0,s.jsx)("div",{className:"flex-1 ml-0 lg:ml-[20%] ",children:t})]})}},263:function(e,t,a){"use strict";var s=a(7437),r=a(2265),l=a(6463),n=a(7453);t.Z=e=>t=>{let{user:a,loading:i}=(0,n.a)(),o=(0,l.useRouter)(),d=(0,l.usePathname)();return((0,r.useEffect)(()=>{i||(a?a.isValidated||"/account-validation"===d||o.push("/account-validation"):o.push("/"))},[a,i,o,d]),!i&&a&&(a.isValidated||"/account-validation"===d))?(0,s.jsx)(e,{...t}):null}}},function(e){e.O(0,[43,358,691,72,648,818,971,23,744],function(){return e(e.s=560)}),_N_E=e.O()}]);