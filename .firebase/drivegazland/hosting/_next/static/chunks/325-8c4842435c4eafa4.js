"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[325],{4768:function(e,t,r){var a=r(7437);r(2265),t.Z=e=>{let{text:t,onRemove:r}=e;return(0,a.jsxs)("span",{className:"bg-greenPrimary text-white px-4 py-2 rounded-lg mr-2 mb-2 font-body flex items-center",children:[t,(0,a.jsx)("button",{onClick:r,className:"ml-4 text-black hover:text-red-500 text-2xl font-bold focus:outline-none",children:"\xd7"})]})}},466:function(e,t,r){r.d(t,{FilesProvider:function(){return o},Y:function(){return c}});var a=r(7437),s=r(2265),i=r(9842),n=r(3908);let l=(0,s.createContext)(void 0),o=e=>{let{children:t}=e,[r,o]=(0,s.useState)(0),[c,d]=(0,s.useState)(!0),[u,h]=(0,s.useState)([]);return(0,s.useEffect)(()=>{let e=(0,i.hJ)(n.db,"linkedTags"),t=(0,i.cf)(e,e=>{h(e.docs.map(e=>({id:e.id,group:e.data().group,tags:e.data().tags})))});return()=>t()},[]),(0,s.useEffect)(()=>{let e=(0,i.cf)((0,i.hJ)(n.db,"files"),e=>{o(e.size),d(!1)},e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des fichiers en temps r\xe9el :",e)});return()=>e()},[]),(0,a.jsx)(l.Provider,{value:{totalFiles:r,loadingFiles:c,searchFilesByTags:(e,t)=>{if(0===e.length)return()=>{};try{let r=(0,i.hJ)(n.db,"files"),a=e.reduce((e,t)=>{let r=u.find(e=>e.tags.includes(t));if(r){let t=r.tags.filter(t=>!e.includes(t));return[...e,...t]}return e.includes(t)?e:[...e,t]},[]),s=(0,i.IO)(r,(0,i.ar)("tags","array-contains-any",a),(0,i.Xo)("createdAt","desc"));return(0,i.cf)(s,r=>{let a=r.docs.map(e=>({id:e.id,...e.data()})).filter(t=>e.every(e=>{let r=u.find(t=>t.tags.includes(e));return r?r.tags.some(e=>t.tags.includes(e)):t.tags.includes(e)}));t(a)})}catch(e){return console.error("Erreur lors de la recherche des fichiers en temps r\xe9el :",e),()=>{}}}},children:t})},c=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useFiles must be used within a FilesProvider");return e}},3215:function(e,t,r){r.d(t,{Sv:function(){return u},_I:function(){return o},cT:function(){return c},mN:function(){return d},qp:function(){return h}});var a=r(3908),s=r(9854),i=r(9842);let n=(0,s.cF)(),l=a.db,o=async(e,t,r,a)=>{try{let o=(0,s.iH)(n,t);await (0,s.oq)(o);let c=(0,i.JU)(l,"files",e);for(let e of(await (0,i.oe)(c),r)){let r=(0,i.JU)(l,"tags",e),a=await (0,i.QT)(r);if(a.exists()){let s=a.data(),n=(s.totalFiles||0)-1;if(n<=0)await (0,i.oe)(r);else if(s.lastAddedFileStoragePath===t){let t="default/noimage.jpeg",a=(0,i.IO)((0,i.hJ)(l,"files"),(0,i.ar)("tags","array-contains",e),(0,i.Xo)("createdAt","desc"),(0,i.b9)(1)),s=await (0,i.PL)(a);s.empty||(t=s.docs[0].data().storagePath),await (0,i.r7)(r,{totalFiles:n,lastAddedFileStoragePath:t})}else await (0,i.r7)(r,{totalFiles:n})}}let d=(0,i.JU)(l,"users",a),u=await (0,i.QT)(d);if(u.exists()){let e=u.data(),r=(e.recentFiles||[]).filter(e=>e!==t);r.length!==e.recentFiles.length?await (0,i.r7)(d,{recentFiles:r}):console.log("Aucun changement dans recentFiles.");let a=(e.favorites||[]).filter(e=>e.storagePath!==t);await (0,i.r7)(d,{favorites:a,totalFileUploads:(0,i.nP)(-1)})}return{success:!0,message:"Fichier supprim\xe9 avec succ\xe8s."}}catch(e){return console.error("Erreur lors de la suppression du fichier :",e),{success:!1,message:"Erreur lors de la suppression du fichier."}}},c=async(e,t,r,a,o)=>{if(!e||!e.name)throw Error("Le fichier est invalide ou manquant.");let c=r.join("_").toLowerCase(),d=e.name.split(".").pop(),u="".concat("image"===t?"images":"videos","/").concat(c,"_").concat(Date.now(),".").concat(d),h=(0,s.iH)(n,u),m=(0,s.B0)(h,e);return new Promise((e,s)=>{m.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);o&&o(t)},e=>{s(e)},async()=>{try{await (0,i.ET)((0,i.hJ)(l,"files"),{name:"".concat(c,".").concat(d),storagePath:u,type:t,tags:r,addBy:a.id,createdAt:new Date}),e(u)}catch(e){console.error("Erreur lors de l'ajout du fichier \xe0 Firestore :",e),s(e)}})})},d=async(e,t)=>{try{let r=(0,i.JU)(a.db,"users",e.id);if(!e.favorites.some(e=>e.storagePath===t.storagePath))return await (0,i.r7)(r,{favorites:(0,i.vr)({id:t.id,storagePath:t.storagePath,name:t.name,type:t.type,addBy:t.addBy,tags:t.tags})}),!0;{let a=e.favorites.find(e=>e.storagePath===t.storagePath);return a&&await (0,i.r7)(r,{favorites:(0,i.Ab)(a)}),!1}}catch(e){return console.error("Erreur lors de la mise \xe0 jour des favoris :",e),!1}},u=async(e,t)=>{try{let r=(0,s.iH)(n,e),a=await (0,s.Br)(r),i=window.URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.setAttribute("download",t||"fichier-inconnu"),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(i)}catch(e){console.error("Erreur lors du t\xe9l\xe9chargement :",e)}},h=async()=>{try{let e=(0,i.hJ)(a.db,"files"),t=(0,i.IO)(e,(0,i.Xo)("createdAt","desc"));return(await (0,i.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration de tous les fichiers :",e),[]}}},1374:function(e,t,r){r.d(t,{a:function(){return l},y:function(){return n}});var a=r(9842),s=r(3908),i=r(1288);let n=async(e,t)=>{let r=(0,a.JU)(s.db,"users",e),n=await (0,a.QT)(r);if(n.exists()){let s=n.data(),l=(s.totalFileUploads||0)+1,o=s.recentFiles||[];o.unshift(t),o.length>3&&(o=o.slice(0,3)),await (0,a.r7)(r,{totalFileUploads:l,recentFiles:o});let c=Array.isArray(s.achievements)?s.achievements:[];for(let t of[{count:1,achievementId:1},{count:8,achievementId:4},{count:13,achievementId:7},{count:69,achievementId:9},{count:99,achievementId:10}])s.totalFileUploads<t.count&&l>=t.count&&!c.includes(t.achievementId)&&(await (0,i.T)(e,t.achievementId),c.push(t.achievementId),await (0,a.r7)(r,{achievements:c}))}else throw Error("Utilisateur non trouv\xe9")},l=async e=>{try{if(!e)return"Utilisateur inconnu";let t=(0,a.JU)(s.db,"users",e),r=await (0,a.QT)(t);if(r.exists())return r.data().pseudonym||"Utilisateur inconnu";return"Utilisateur inconnu"}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur :",e),"Erreur utilisateur"}}},3390:function(e,t,r){var a=r(7437),s=r(2265),i=r(6648),n=r(4589),l=r(842),o=r(5373),c=r(4413),d=r(4954),u=r(9651),h=r(6730),m=r(2103),f=r(6463),x=r(7453),g=r(8786),p=r(466);t.Z=e=>{let{children:t}=e,[r,v]=(0,s.useState)(!1),w=(0,f.useRouter)(),{logout:y}=(0,x.a)(),{totalTags:j}=(0,g.e)(),{totalFiles:b,loadingFiles:N}=(0,p.Y)(),{user:k}=(0,x.a)(),E=async()=>{try{await y(),w.push("/")}catch(e){console.error("Erreur lors de la d\xe9connexion\xa0:",e)}},F=()=>{w.push("/profile")},P=()=>{w.push("/audio")},U=()=>{v(!1)};return(0,s.useEffect)(()=>{r?document.body.style.overflow="hidden":document.body.style.overflow="auto"},[r]),(0,a.jsxs)("div",{className:"flex relative",children:[!r&&(0,a.jsx)("button",{className:"lg:hidden fixed top-8 left-4 z-50 text-white",onClick:()=>v(!r),children:(0,a.jsx)(n.Z,{className:"w-8 h-8"})}),r&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30",onClick:U}),(0,a.jsx)("aside",{className:"fixed top-0 left-0 z-40 w-[75%] lg:w-[20%] h-screen bg-dark2 text-white transform ".concat(r?"translate-x-0":"-translate-x-full"," transition-transform duration-300 ease-in-out lg:translate-x-0"),children:(0,a.jsx)("div",{className:"flex flex-col h-full px-4 py-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-center mb-8 md:mb-12",children:(0,a.jsx)(i.default,{src:"/images/GazlandprojetDashboard.png",alt:"Logo",layout:"intrinsic",width:250,height:125,className:"h-6"})}),(0,a.jsxs)("ul",{className:"space-y-2 font-medium",children:[(0,a.jsx)("li",{children:(0,a.jsxs)("a",{href:"/dashboard",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:U,children:[(0,a.jsx)(l.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,a.jsx)("span",{className:"ml-3",children:"Accueil"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("a",{href:"/audio",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:()=>{P(),U()},children:[(0,a.jsx)(o.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,a.jsx)("span",{className:"ml-3",children:"Audio"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("a",{href:"/ranking",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:()=>{w.push("/ranking")},children:[(0,a.jsx)(c.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,a.jsx)("span",{className:"ml-3",children:"Classement"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("a",{href:"/linked",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:U,children:[(0,a.jsx)(d.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,a.jsx)("span",{className:"ml-3",children:"Tags li\xe9s"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("a",{href:"#",className:"flex items-center p-2 text-gray-100 rounded-lg dark:text-white hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",onClick:()=>{F(),U()},children:[(0,a.jsx)(u.Z,{className:"w-6 h-6 text-gray-400 group-hover:text-white"}),(0,a.jsx)("span",{className:"ml-3",children:"Mon Profil"})]})})]}),(0,a.jsxs)("div",{className:"mt-8 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-dark3",children:[(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"w-6 h-6 me-2"}),"Tous les fichiers"]}),(0,a.jsx)("span",{className:"bg-gray-700 text-xs rounded-md px-2 py-1",children:b})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-dark3",children:[(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"w-6 h-6 me-2"}),"Tous les dossiers"]}),(0,a.jsx)("span",{className:"bg-gray-700 text-xs rounded-md px-2 py-1",children:j})]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("button",{onClick:E,className:"flex items-center w-full p-2 rounded-lg hover:bg-gray-700 hover:text-white transition duration-150 ease-in-out",children:[(0,a.jsx)(m.Z,{className:"w-6 h-6 text-gray-400"}),(0,a.jsx)("span",{className:"ml-3",children:"D\xe9connexion"})]})})]})})}),(0,a.jsx)("div",{className:"flex-1 ml-0 lg:ml-[20%] ",children:t})]})}},263:function(e,t,r){var a=r(7437),s=r(2265),i=r(6463),n=r(7453);t.Z=e=>t=>{let{user:r,loading:l}=(0,n.a)(),o=(0,i.useRouter)(),c=(0,i.usePathname)();return((0,s.useEffect)(()=>{l||(r?r.isValidated||"/account-validation"===c||o.push("/account-validation"):o.push("/"))},[r,l,o,c]),!l&&r&&(r.isValidated||"/account-validation"===c))?(0,a.jsx)(e,{...t}):null}}}]);