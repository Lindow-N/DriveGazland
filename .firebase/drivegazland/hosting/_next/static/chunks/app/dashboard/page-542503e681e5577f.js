(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8861:function(e,t,a){Promise.resolve().then(a.bind(a,1813))},1813:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return F}});var s=a(7437),r=a(2265),l=a(3390),n=a(6463),i=a(4380),o=a(2023),d=a(8786),c=a(466),u=a(4768),m=e=>{let{greetingText:t,onSearchResults:a}=e,l=(0,n.useRouter)(),{tags:m}=(0,d.e)(),{searchFilesByTags:h}=(0,c.Y)(),[x,g]=(0,r.useState)(""),[f,p]=(0,r.useState)([]),[v,y]=(0,r.useState)([]);(0,r.useEffect)(()=>{x.length>0?p(m.filter(e=>e.toLowerCase().startsWith(x.toLowerCase())).slice(0,5)):p([])},[x,m]);let j=e=>{v.includes(e)||y(t=>[...t,e]),g(""),p([])},w=e=>{y(t=>t.filter(t=>t!==e))};return(0,r.useEffect)(()=>{v.length>0?h(v).then(e=>{a(e)}):a([])},[v,h,a]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("header",{className:"bg-dark2 px-8 py-7 flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-white text-lg md:text-3xl ml-6 hidden lg:block",children:t}),(0,s.jsxs)("div",{className:"flex items-center w-full lg:w-2/3 ml-6 justify-between",children:[(0,s.jsxs)("div",{className:"relative flex items-center bg-dark3 rounded-lg w-full lg:w-3/4 mr-4",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5 text-gray-400 ml-2"}),(0,s.jsx)("input",{type:"text",placeholder:"Rechercher des tags...",value:x,onChange:e=>g(e.target.value),className:"w-full px-2 py-2 bg-dark3 text-white placeholder-gray-400 rounded-lg focus:outline-none"}),f.length>0&&(0,s.jsx)("div",{className:"absolute top-full mt-2 w-full bg-dark3 rounded-md shadow-lg max-h-40 overflow-y-auto z-10",children:f.map(e=>(0,s.jsx)("div",{className:"p-2 hover:bg-dark2 cursor-pointer text-white",onClick:()=>j(e),children:e},e))})]}),(0,s.jsxs)("button",{onClick:()=>{l.push("/uploadMedia")},className:"flex items-center bg-greenPrimary text-white px-2 py-2 rounded-lg hover:bg-green-600 transition duration-150 ease-in-out whitespace-nowrap",children:[(0,s.jsx)(o.Z,{className:"w-7 h-7 mr-0 md:mr-2"}),(0,s.jsx)("span",{className:"hidden md:inline",children:"Ajouter un m\xe9dia"})]})]})]}),v.length>0&&(0,s.jsx)("div",{className:"bg-dark1 py-4 px-8",children:(0,s.jsx)("div",{className:"flex flex-wrap justify-center",children:v.map((e,t)=>(0,s.jsx)(u.Z,{text:e,onRemove:()=>w(e)},t))})})]})},h=a(2549),x=a(3617),g=a(6218),f=a(1725),p=a(2560),v=a(7206),y=a(3215),j=a(7453),w=a(9854),b=a(3908),N=a(9842);let k=e=>e.startsWith("videos/");var P=e=>{let{files:t,currentIndex:a,onClose:l}=e,{user:n}=(0,j.a)(),[i,o]=(0,r.useState)(a),[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(""),[h,P]=(0,r.useState)(null),C=t[i];(0,r.useEffect)(()=>{let e=null==n?void 0:n.favorites.some(e=>(null==e?void 0:e.storagePath)===(null==C?void 0:C.storagePath));c(null!=e&&e);let t=async()=>{try{if(!(null==C?void 0:C.addBy)){P("Utilisateur inconnu");return}let e=(0,N.JU)(b.db,"users",C.addBy),t=await (0,N.QT)(e);if(t.exists()){let e=t.data();P(e.pseudonym||"Utilisateur inconnu")}else P("Utilisateur inconnu")}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur :",e),P("Erreur utilisateur")}};(async()=>{try{let e=await (0,w.Jt)((0,w.iH)(b.t,C.storagePath));m(e)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'URL de l'image :",e)}})(),t()},[C,n]),(0,r.useEffect)(()=>{if(n&&C){let e=(0,N.JU)(b.db,"users",n.id),t=(0,N.cf)(e,e=>{if(e.exists()){var t;let a=e.data(),s=null==a?void 0:null===(t=a.favorites)||void 0===t?void 0:t.some(e=>(null==e?void 0:e.storagePath)===(null==C?void 0:C.storagePath));c(null!=s&&s)}});return()=>t()}},[n,C]);let S=()=>{o(e=>e===t.length-1?0:e+1)},E=()=>{o(e=>0===e?t.length-1:e-1)},F=(0,v.QS)({onSwipedLeft:S,onSwipedRight:E,preventScrollOnSwipe:!0,trackMouse:!0}),B=async()=>{if(!n){console.error("L'utilisateur n'est pas authentifi\xe9.");return}try{let e=(0,w.iH)(b.t,C.storagePath),t=await (0,w.Br)(e),a=window.URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.setAttribute("download",C.name||"fichier-inconnu"),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("Erreur lors du t\xe9l\xe9chargement :",e)}},T=async()=>{let e=await (0,y.m)(n,C);c(e),e||(t.length>1?S():l())};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",onClick:l,children:(0,s.jsxs)("div",{className:"relative w-full max-w-3xl max-h-[85vh] bg-dark3 rounded-lg shadow-lg overflow-hidden",onClick:e=>e.stopPropagation(),...F,children:[(0,s.jsxs)("div",{className:"bg-dark2 py-2 px-4 flex flex-col",children:[(0,s.jsx)("span",{className:"text-white text-lg truncate",children:null==C?void 0:C.name}),(0,s.jsxs)("span",{className:"text-gray-400 text-sm",children:["Ajout\xe9 par : ",h]}),(0,s.jsx)("button",{onClick:l,className:"absolute top-2 right-2 text-white",children:(0,s.jsx)(x.Z,{className:"w-6 h-6"})})]}),(0,s.jsx)("div",{className:"flex items-center justify-center w-full h-full max-h-[70vh] p-4 overflow-hidden",children:k(null==C?void 0:C.storagePath)?(0,s.jsx)("video",{src:u,className:"max-w-full max-h-full object-contain",controls:!0,autoPlay:!0}):(0,s.jsx)("img",{src:u,alt:C.name,className:"max-w-full max-h-full object-contain",style:{maxHeight:"calc(70vh - 4rem)",maxWidth:"100%"}})}),(0,s.jsx)("button",{onClick:E,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-white text-5xl md:text-6xl lg:text-7xl p-2",children:"‹"}),(0,s.jsx)("button",{onClick:S,className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-white text-5xl md:text-6xl lg:text-7xl p-2",children:"›"}),(0,s.jsxs)("div",{className:"bg-dark2 py-3 px-4 flex flex-col md:flex-row justify-around space-y-4 md:space-y-0 md:space-x-4",children:[(0,s.jsxs)("button",{className:"bg-greenPrimary text-white px-4 py-2 rounded-md flex items-center justify-center md:inline-block",onClick:B,children:[(0,s.jsx)(g.Z,{className:"w-5 h-5 md:hidden"}),(0,s.jsx)("span",{className:"hidden md:inline",children:"T\xe9l\xe9charger"})]}),(0,s.jsxs)("button",{className:"bg-greenPrimary text-white px-4 py-2 rounded-md flex items-center justify-center md:inline-block",onClick:T,children:[d?(0,s.jsx)(f.Z,{className:"w-5 h-5 fill-current text-red-500 md:hidden"}):(0,s.jsx)(f.Z,{className:"w-5 h-5 md:hidden"}),(0,s.jsx)("span",{className:"hidden md:inline",children:d?"Retirer des Favoris":"Ajouter aux Favoris"})]}),(0,s.jsxs)("button",{className:"bg-redPrimary text-white px-4 py-2 rounded-md flex items-center justify-center md:inline-block",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5 md:hidden"}),(0,s.jsx)("span",{className:"hidden md:inline",children:"Supprimer"})]})]})]})})},C=a(4364);let S=e=>e.startsWith("videos/");var E=e=>{let{files:t,isTagView:a=!1}=e,[l,n]=(0,r.useState)(null),[i,o]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{o(await Promise.all(t.map(async e=>await (0,C.SH)(e.storagePath))))})()},[t]);let d=e=>{a||n(e)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 p-4 sm:p-8 md:px-16",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"bg-dark2 rounded-lg shadow-md p-4 cursor-pointer transition duration-150 ease-in-out ".concat(a?"":"hover:bg-dark3"),onClick:()=>d(t),children:[S(e.storagePath)?(0,s.jsx)("video",{className:"w-full h-32 md:h-40 object-cover rounded-md mb-4",src:i[t]||"",onLoadedData:e=>{let t=e.currentTarget;t.currentTime=1,t.pause()},muted:!0,controls:!1}):(0,s.jsx)("img",{src:i[t]||"",alt:e.name,className:"w-full h-32 md:h-40 object-cover rounded-md mb-4"}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-white font-bold text-sm md:text-lg",children:e.name.length>12?"".concat(e.name.slice(0,12),"..."):e.name}),(0,s.jsx)("span",{className:"bg-gray-700 text-xs text-white rounded-md px-2 py-1",children:e.totalFiles})]})]},e.id))}),null!==l&&(0,s.jsx)(P,{files:t,currentIndex:l,onClose:()=>{n(null)}})]})},F=(0,a(263).Z)(()=>{let e;let{user:t}=(0,j.a)(),{tagsWithData:a,loadingTags:n}=(0,d.e)(),[i,o]=(0,r.useState)("Tous les tags"),[c,u]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),f=async()=>{if(t)try{let e=(0,N.JU)(b.db,"users",t.id),a=await (0,N.QT)(e);if(a.exists()){let e=a.data();e.favorites&&g(e.favorites)}}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des favoris :",e)}};(0,r.useEffect)(()=>{f()},[t]);let p=c.map(e=>{var t;return{id:e.id,storagePath:e.storagePath,name:e.name,totalFiles:(null===(t=e.tags)||void 0===t?void 0:t.length)||1,type:e.storagePath.startsWith("videos/")?"video":"image",addBy:e.addBy,tags:e.tags}}),v=a.map(e=>({id:e.id,storagePath:e.data.lastAddedFileStoragePath,name:e.data.name,totalFiles:e.data.totalFiles||1,createdBy:e.data.createdBy,type:e.data.lastAddedFileStoragePath.startsWith("videos/")?"video":"image"})),y=x.map(e=>{var t;return{id:e.id,storagePath:e.storagePath,name:e.name,totalFiles:(null===(t=e.tags)||void 0===t?void 0:t.length)||1,type:e.storagePath.startsWith("videos/")?"video":"image",addBy:e.addBy,tags:e.tags}});return console.log(e="Fichiers favoris"===i?y:c.length>0?p:v,"filesToDisplay"),(0,s.jsxs)(l.Z,{children:[(0,s.jsx)(m,{greetingText:"Bienvenue, ".concat(null==t?void 0:t.pseudonym," !"),onSearchResults:u}),0===c.length&&(0,s.jsx)(h.Z,{categories:["Tous les tags","Fichiers favoris"],selectedCategory:i,onCategorySelect:o}),(0,s.jsx)("div",{className:"min-h-screen bg-dark1",children:n?(0,s.jsx)("p",{children:"Chargement des tags..."}):(0,s.jsx)(E,{files:e,isTagView:"Tous les tags"===i&&0===c.length})})]})})},2549:function(e,t,a){"use strict";var s=a(7437);a(2265),t.Z=e=>{let{categories:t,selectedCategory:a,onCategorySelect:r}=e;return(0,s.jsxs)("div",{className:"bg-dark1 p-4 sm:p-8 md:p-16 md:pb-0",children:[(0,s.jsx)("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white mb-4",children:a}),(0,s.jsx)("div",{className:"flex space-x-2 sm:space-x-4 overflow-x-auto",children:t.map(e=>(0,s.jsx)("button",{onClick:()=>r(e),className:"px-3 py-1 sm:px-4 sm:py-2 rounded-md text-sm sm:text-md md:text-lg transition duration-150 ease-in-out ".concat(a===e?"bg-dark3 text-white":"bg-transparent text-gray-400 opacity-80"," hover:bg-dark2 hover:text-white"),children:e},e))})]})}},4768:function(e,t,a){"use strict";var s=a(7437);a(2265),t.Z=e=>{let{text:t,onRemove:a}=e;return(0,s.jsxs)("span",{className:"bg-greenPrimary text-white px-4 py-2 rounded-lg mr-2 mb-2 font-body flex items-center",children:[t,(0,s.jsx)("button",{onClick:a,className:"ml-4 text-black hover:text-red-500 text-2xl font-bold focus:outline-none",children:"\xd7"})]})}},3215:function(e,t,a){"use strict";a.d(t,{c:function(){return o},m:function(){return d}});var s=a(9854),r=a(9842),l=a(3908);let n=(0,s.cF)(),i=l.db,o=async(e,t,a,l,o)=>{if(!e||!e.name)throw Error("Le fichier est invalide ou manquant.");let d=a.join("_").toLowerCase(),c=e.name.split(".").pop(),u="".concat("image"===t?"images":"videos","/").concat(d,"_").concat(Date.now(),".").concat(c),m=(0,s.iH)(n,u),h=(0,s.B0)(m,e);return new Promise((e,s)=>{h.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);o&&o(t)},e=>{s(e)},async()=>{try{await (0,r.ET)((0,r.hJ)(i,"files"),{name:"".concat(d,".").concat(c),storagePath:u,type:t,tags:a,addBy:l.id,createdAt:new Date}),console.log("Fichier ajout\xe9 avec succ\xe8s dans Firestore avec storagePath."),e(u)}catch(e){console.error("Erreur lors de l'ajout du fichier \xe0 Firestore :",e),s(e)}})})},d=async(e,t)=>{console.log(t,"currentFile");try{let a=(0,r.JU)(l.db,"users",e.id);if(!e.favorites.some(e=>e.storagePath===t.storagePath))return await (0,r.r7)(a,{favorites:(0,r.vr)({id:t.id,storagePath:t.storagePath,name:t.name,type:t.type,addBy:t.addBy,tags:t.tags})}),!0;{let s=e.favorites.find(e=>e.storagePath===t.storagePath);return s&&await (0,r.r7)(a,{favorites:(0,r.Ab)(s)}),!1}}catch(e){return console.error("Erreur lors de la mise \xe0 jour des favoris :",e),!1}}}},function(e){e.O(0,[358,691,697,666,20,971,23,744],function(){return e(e.s=8861)}),_N_E=e.O()}]);