(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{560:function(e,t,a){Promise.resolve().then(a.bind(a,535))},535:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var l=a(7437),i=a(2265),s=a(8746),r=a(8872);a(2392);var n=a(3390),o=a(263),d=a(4364),c=a(3215),u=a(9842),m=a(3908),h=a(1288);let g=async(e,t,a)=>{let l=(0,u.JU)(m.db,"tags",e),i=await (0,u.QT)(l);if(i.exists()){let e=i.data();await (0,u.pl)(l,{...e,totalFiles:e.totalFiles+1,lastAddedFileStoragePath:t},{merge:!0})}else{await (0,u.pl)(l,{name:e,totalFiles:1,lastAddedFileStoragePath:t,createdBy:a.id,createdAt:new Date});let i=(0,u.JU)(m.db,"users",a.id),s=await (0,u.QT)(i);if(s.exists()){let t=s.data(),l=t.createdTags||[];if(!l.includes(e)){l.push(e),await (0,u.r7)(i,{createdTags:l});let s=t.achievements||[],r=l.length;for(let e of[{count:7,achievementId:3},{count:10,achievementId:6},{count:21,achievementId:8},{count:50,achievementId:12}])r>=e.count&&!s.includes(e.achievementId)&&(await (0,h.T)(a.id,e.achievementId),await (0,u.r7)(i,{achievements:[...s,e.achievementId]}))}}}if("2000"===e){let e=(0,u.JU)(m.db,"users",a.id),t=await (0,u.QT)(e);if(t.exists()){let l=t.data().achievements||[];l.includes(2)||(await (0,h.T)(a.id,2),await (0,u.r7)(e,{achievements:[...l,2]}))}}};var x=a(7453),v=a(1374),f=a(8786),b=a(2126),p=a(4768),w=e=>{let{tagsWithData:t,onTagClick:a}=e,i=t.sort((e,t)=>t.data.totalFiles-e.data.totalFiles);return(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("h3",{className:"text-white font-bold font-subtitle mb-4",children:"Tags populaires :"}),(0,l.jsx)("div",{className:"flex flex-wrap",children:i.map(e=>(0,l.jsx)("button",{onClick:()=>a(e.data.name),className:"bg-greenPrimary text-white px-4 py-2 rounded-lg mr-3 mb-3 font-body hover:bg-green-600",children:e.data.name},e.id))})]})},j=(0,o.Z)(()=>{var e,t,a,o,u,m,h,j,y,N;let[k,C]=(0,i.useState)([]),[S,T]=(0,i.useState)(""),[E,F]=(0,i.useState)([]),[I,P]=(0,i.useState)(0),[A,D]=(0,i.useState)(!1),[U,_]=(0,i.useState)(!1),[z,L]=(0,i.useState)(0),{user:W}=(0,x.a)(),{tags:Z,tagsWithData:J}=(0,f.e)(),O=e=>{if(""===e.trim())return;let t=[...k];t[I].tags=(0,d.Pn)(t[I].tags,e),C(t),T(""),F([])},Q=e=>{let t=[...k];t[I].tags=t[I].tags.filter(t=>t!==e),C(t)},{getRootProps:R,getInputProps:q}=(0,s.uI)({onDrop:e=>{let t=e.map(e=>({id:e.name+Date.now(),file:e,preview:URL.createObjectURL(e),tags:[]}));C(e=>[...e,...t]),D(!1)},onDragEnter:()=>D(!0),onDragLeave:()=>D(!1)}),B=async()=>{_(!0),L(0);try{let e=k[I],t=(0,c.cT)(e.file,e.file.type.startsWith("image")?"image":"video",e.tags,W,e=>L(e)),a=await t;for(let t of e.tags)await g(t,a,W);await (0,v.y)(null==W?void 0:W.id,a),(0,b.XA)(),I+1<k.length?P(I+1):(C([]),P(0)),T(""),L(100)}catch(e){console.error("Erreur lors de l'upload :",e),(0,b.Eo)("Erreur lors de l'upload")}finally{_(!1)}},G=e=>{let t=[...k];t.splice(e,1),C(t),e>=t.length&&P(t.length-1)};return(0,l.jsx)(n.Z,{children:(0,l.jsxs)("div",{className:"bg-dark1 min-h-screen p-8 pb-32 lg:pb-8 ",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-white mb-6 font-title lg:ml-0 ml-6",children:"Ajouter un M\xe9dia"}),0===k.length&&(0,l.jsxs)("div",{...R(),className:"border-2 border-dashed p-8 rounded-md flex justify-center items-center cursor-pointer transition-colors duration-200 ".concat(A?"border-greenPrimary bg-dark3":"border-gray-500 bg-dark2"),children:[(0,l.jsx)("input",{...q()}),(0,l.jsx)("p",{className:"text-gray-400 font-body",children:"Glissez et d\xe9posez des fichiers ici, ou cliquez pour s\xe9lectionner"})]}),k.length>0&&(0,l.jsxs)("div",{className:"mt-6 max-w-lg mx-auto",children:[(0,l.jsxs)("div",{className:"text-white mb-4 font-bold font-subtitle text-center",children:[I+1," sur ",k.length]}),(0,l.jsxs)("div",{className:"relative bg-dark2 p-4 rounded-lg shadow-md w-full",children:[(null===(t=k[I])||void 0===t?void 0:null===(e=t.file)||void 0===e?void 0:e.type.startsWith("video"))?(0,l.jsx)("video",{src:k[I].preview,controls:!0,className:"w-full max-w-[500px] max-h-[400px] h-auto object-contain rounded-md mb-4",onError:()=>console.log("Erreur de lecture de la vid\xe9o",k[I].file)}):(0,l.jsx)(r.Z,{children:(0,l.jsx)("img",{src:null===(a=k[I])||void 0===a?void 0:a.preview,alt:"Image active",className:"w-full max-w-[500px] max-h-[400px] h-auto object-contain rounded-md mb-4 cursor-pointer"})}),(0,l.jsx)("button",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white w-10 h-10 flex items-center justify-center hover:bg-opacity-70",style:{fontSize:"28px",lineHeight:"28px"},onClick:()=>G(I),children:"\xd7"}),(0,l.jsx)("div",{className:"text-white font-bold font-subtitle mb-2 text-center",children:null===(o=k[I])||void 0===o?void 0:o.tags.join(" ")})]}),U?(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:(0,l.jsx)("div",{className:"bg-greenPrimary h-2.5 rounded-full",style:{width:"".concat(z,"%")}})}),(0,l.jsxs)("p",{className:"text-center text-white mt-2 font-body",children:[z,"%"]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center mt-4 w-full relative",children:[(0,l.jsx)("input",{type:"text",value:S,onChange:e=>{let t=e.target.value.toLowerCase();T(t),t.length>0?F(Z.filter(e=>e.toLowerCase().startsWith(t))):F([])},placeholder:"Ajouter un tag",className:"bg-dark3 text-white p-2 rounded-md focus:outline-none font-body w-full mr-2"}),(0,l.jsx)("button",{onClick:()=>O(S),className:"bg-greenPrimary text-white px-3 py-2 rounded-md font-body ".concat(""===S.trim()?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:""===S.trim(),children:"Ajouter"}),E.length>0&&(0,l.jsx)("div",{className:"absolute top-full mt-2 w-full bg-dark3 rounded-md shadow-lg max-h-28 overflow-y-auto z-10",children:E.map(e=>(0,l.jsx)("div",{className:"p-2 hover:bg-dark2 cursor-pointer text-white",onClick:()=>O(e),children:e},e))})]}),(0,l.jsx)("div",{className:"flex flex-wrap mt-4",children:null===(m=k[I])||void 0===m?void 0:null===(u=m.tags)||void 0===u?void 0:u.map((e,t)=>(0,l.jsx)(p.Z,{text:e,onRemove:()=>Q(e)},t))}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)("button",{onClick:B,className:"bg-greenPrimary text-white px-4 py-2 rounded-md font-body w-full ".concat((null===(j=k[I])||void 0===j?void 0:null===(h=j.tags)||void 0===h?void 0:h.length)===0?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:(null===(N=k[I])||void 0===N?void 0:null===(y=N.tags)||void 0===y?void 0:y.length)===0,children:"Upload Fichier"})})]})]}),k.length>0&&(0,l.jsx)(w,{tagsWithData:J,onTagClick:O})]})})})}},function(e){e.O(0,[43,358,691,697,34,746,453,325,971,23,744],function(){return e(e.s=560)}),_N_E=e.O()}]);