(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8861:function(e,t,s){Promise.resolve().then(s.bind(s,1813))},1813:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Z}});var a=s(7437),l=s(2265),r=s(3390),i=s(6463),n=s(4380),d=s(2023),o=s(8786),c=s(466),u=s(4768),m=e=>{let{greetingText:t,onSearchResults:s,selectedTags:r,setSelectedTags:m}=e,h=(0,i.useRouter)(),{tags:x}=(0,o.e)(),{searchFilesByTags:g}=(0,c.Y)(),[f,p]=(0,l.useState)(""),[v,w]=(0,l.useState)([]);(0,l.useEffect)(()=>{f.length>0?w(x.filter(e=>e.toLowerCase().startsWith(f.toLowerCase())).slice(0,5)):w([])},[f,x]);let j=e=>{r.includes(e)||m(t=>[...t,e]),p(""),w([])},y=e=>{m(t=>t.filter(t=>t!==e))};return(0,l.useEffect)(()=>{let e=()=>{};return r.length>0?e=g(r,e=>{s(e)}):s([]),()=>{e()}},[r,g,s]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("header",{className:"bg-dark2 px-8 py-7 flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-white text-lg md:text-3xl ml-6 hidden lg:block",children:t}),(0,a.jsxs)("div",{className:"flex items-center w-full lg:w-2/3 ml-6 justify-between",children:[(0,a.jsxs)("div",{className:"relative flex items-center bg-dark3 rounded-lg w-full lg:w-3/4 mr-4",children:[(0,a.jsx)(n.Z,{className:"w-5 h-5 text-gray-400 ml-2"}),(0,a.jsx)("input",{type:"text",placeholder:"Rechercher des tags...",value:f,onChange:e=>p(e.target.value),className:"w-full px-2 py-2 bg-dark3 text-white placeholder-gray-400 rounded-lg focus:outline-none"}),v.length>0&&(0,a.jsx)("div",{className:"absolute top-full mt-2 w-full bg-dark3 rounded-md shadow-lg max-h-40 overflow-y-auto z-10",children:v.map(e=>(0,a.jsx)("div",{className:"p-2 hover:bg-dark2 cursor-pointer text-white",onClick:()=>j(e),children:e},e))})]}),(0,a.jsxs)("button",{onClick:()=>{h.push("/uploadMedia")},className:"flex items-center bg-greenPrimary text-white px-2 py-2 rounded-lg hover:bg-green-600 transition duration-150 ease-in-out whitespace-nowrap",children:[(0,a.jsx)(d.Z,{className:"w-7 h-7 mr-0 md:mr-2"}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Ajouter un m\xe9dia"})]})]})]}),r.length>0&&(0,a.jsx)("div",{className:"bg-dark1 py-4 px-8",children:(0,a.jsx)("div",{className:"flex flex-wrap justify-center",children:r.map((e,t)=>(0,a.jsx)(u.Z,{text:e,onRemove:()=>y(e)},t))})})]})},h=s(2549),x=s(3617),g=s(6218),f=s(1725),p=s(2560),v=s(7206),w=s(3215),j=s(7453),y=s(9842),b=s(3908),N=s(4364),k=s(1374),S=s(2126),P=s(1288);let C=e=>!!e&&e.startsWith("videos/");var T=e=>{let{files:t,currentIndex:s,onClose:r}=e,{user:i}=(0,j.a)(),[n,d]=(0,l.useState)(s),[o,c]=(0,l.useState)(!1),[u,m]=(0,l.useState)(""),[h,T]=(0,l.useState)(null),F=t[n];(0,l.useEffect)(()=>{let e=null==i?void 0:i.favorites.some(e=>(null==e?void 0:e.storagePath)===(null==F?void 0:F.storagePath));c(null!=e&&e),(async()=>{try{let e=await (0,N.SH)(null==F?void 0:F.storagePath);e&&m(e)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'URL de l'image :",e)}})(),(0,k.a)(),E()},[F,i]),(0,l.useEffect)(()=>{if(i&&F){let e=(0,y.JU)(b.db,"users",i.id),t=(0,y.cf)(e,e=>{if(e.exists()){var t;let s=e.data(),a=null==s?void 0:null===(t=s.favorites)||void 0===t?void 0:t.some(e=>(null==e?void 0:e.storagePath)===(null==F?void 0:F.storagePath));c(null!=a&&a)}});return()=>t()}},[i,F]);let E=async()=>{T(await (0,k.a)(null==F?void 0:F.addBy))},Z=()=>{d(e=>e===t.length-1?0:e+1)},A=()=>{d(e=>0===e?t.length-1:e-1)},B=(0,v.QS)({onSwipedLeft:Z,onSwipedRight:A,preventScrollOnSwipe:!0,trackMouse:!0}),L=async()=>{if(!i){console.error("L'utilisateur n'est pas authentifi\xe9.");return}try{await (0,w.Sv)(null==F?void 0:F.storagePath,null==F?void 0:F.name);let e=Array.isArray(i.achievements)&&i.achievements.includes(5);i&&!e&&await (0,P.T)(i.id,5)}catch(e){console.error("Erreur lors du t\xe9l\xe9chargement :",e)}},R=async()=>{let e=await (0,w.mN)(i,F);c(e),e||(t.length>1?Z():r())},_=async()=>{if(!F||!i){console.error("Le fichier ou l'utilisateur est manquant.");return}try{let e=await (0,w._I)(F.id,F.storagePath,F.tags,i.id);e.success?((0,S.XA)("D\xe9gage grosse pute !"),t.length>1?Z():r()):console.error(e.message)}catch(e){console.error("Erreur lors de la suppression du fichier :",e)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",onClick:r,children:(0,a.jsxs)("div",{className:"relative w-full max-w-5xl md:max-h-screen bg-dark3 rounded-lg shadow-lg overflow-auto max-h-[80vh] md:max-h-full md:max-w-[90%] mx-auto",onClick:e=>e.stopPropagation(),...B,children:[(0,a.jsxs)("div",{className:"bg-dark2 py-2 px-4 flex flex-col",children:[(0,a.jsx)("span",{className:"text-white text-lg truncate",children:null==F?void 0:F.name}),(0,a.jsxs)("span",{className:"text-gray-400 text-sm",children:["Ajout\xe9 par : ",h]}),(0,a.jsx)("button",{onClick:r,className:"absolute top-2 right-2 text-white md:text-lg text-base",children:(0,a.jsx)(x.Z,{className:"w-5 h-5 md:w-6 md:h-6"})})]}),(0,a.jsx)("div",{className:"flex items-center justify-center w-full h-full p-4 overflow-hidden",children:C(null==F?void 0:F.storagePath)?(0,a.jsx)("video",{src:u,className:"max-w-full max-h-[50vh] md:max-h-[70vh] object-contain",controls:!0,autoPlay:!0}):(0,a.jsx)("img",{src:u,alt:null==F?void 0:F.name,className:"max-w-full max-h-[50vh] md:max-h-[70vh] object-contain"})}),(0,a.jsx)("button",{onClick:A,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-white text-3xl md:text-5xl p-2",children:"‹"}),(0,a.jsx)("button",{onClick:Z,className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-white text-3xl md:text-5xl p-2",children:"›"}),(0,a.jsxs)("div",{className:"bg-dark2 py-3 px-4 flex flex-col space-y-4 md:flex-row md:space-y-0 md:space-x-4 md:justify-between md:items-center",children:[(0,a.jsxs)("div",{className:"flex space-x-4 justify-center md:justify-start w-full md:w-auto",children:[(0,a.jsxs)("button",{className:"bg-greenPrimary text-white px-4 py-2 rounded-md flex items-center justify-center w-full md:w-auto",onClick:L,children:[(0,a.jsx)(g.Z,{className:"w-5 h-5 md:hidden"}),(0,a.jsx)("span",{className:"hidden md:inline",children:"T\xe9l\xe9charger"})]}),(0,a.jsxs)("button",{className:"bg-greenPrimary text-white px-4 py-2 rounded-md flex items-center justify-center w-full md:w-auto",onClick:R,children:[o?(0,a.jsx)(f.Z,{className:"w-5 h-5 fill-current text-red-500 md:hidden"}):(0,a.jsx)(f.Z,{className:"w-5 h-5 md:hidden"}),(0,a.jsx)("span",{className:"hidden md:inline",children:o?"Retirer des Favoris":"Ajouter aux Favoris"})]})]}),(0,a.jsxs)("button",{className:"bg-redPrimary text-white px-4 py-2 rounded-md flex items-center justify-center w-full md:w-auto md:self-end",onClick:_,children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 md:hidden"}),(0,a.jsx)("span",{className:"hidden md:inline",children:"Supprimer"})]})]})]})})};let F=e=>e.startsWith("videos/");var E=e=>{let{files:t,isTagView:s=!1,onTagClick:r}=e,[i,n]=(0,l.useState)(null),[d,o]=(0,l.useState)([]),[c,u]=(0,l.useState)([]),[m,h]=(0,l.useState)((0,N.ep)(t,s,35)),[x,g]=(0,l.useState)(!1),[f,p]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{o(await Promise.all(t.map(async e=>await (0,N.SH)(e.storagePath))))})()},[t]),(0,l.useEffect)(()=>{let e=setTimeout(()=>g(!0),1e3);return()=>clearTimeout(e)},[]),(0,l.useEffect)(()=>{u(t.slice(0,m)),p(Array(t.length).fill(!0))},[t,m,s]);let v=e=>{if(s){var a;let s=null===(a=t[e])||void 0===a?void 0:a.name;s&&r&&(r(s),window.scrollTo({top:0,behavior:"smooth"}))}else n(e)},w=e=>{let t=[...f];t[e]=!1,p(t)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 p-4 sm:p-8 md:px-16",children:[c.map((e,t)=>(0,a.jsxs)("div",{className:"bg-dark2 rounded-lg shadow-md p-4 cursor-pointer transition duration-150 ease-in-out hover:bg-dark3",onClick:()=>v(t),children:[F(e.storagePath)?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("video",{className:"w-full h-32 md:h-40 object-cover rounded-md mb-4",src:d[t]||"",onLoadedData:()=>w(t),onLoadedMetadata:e=>{let t=e.currentTarget;t.currentTime=1,t.pause()},muted:!0,controls:!1})}):(0,a.jsx)("img",{src:d[t]||"",alt:e.name,className:"w-full h-32 md:h-40 object-cover rounded-md mb-4",loading:"lazy"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-white font-bold text-sm md:text-lg",children:e.name.length>10?"".concat(e.name.slice(0,10),"..."):e.name}),(0,a.jsx)("span",{className:"bg-gray-700 text-xs text-white rounded-md px-2 py-1",children:e.totalFiles})]})]},e.id)),x&&c.length<t.length&&(0,a.jsx)("div",{className:"bg-dark2 rounded-lg shadow-md p-4 w-full text-white font-bold text-lg cursor-pointer flex justify-center items-center hover:bg-dark3 transition h-52 sm:h-52 md:h-56 lg:h-64",onClick:()=>{h(e=>e+50)},children:"Voir plus"})]}),null!==i&&(0,a.jsx)(T,{files:t,currentIndex:i,onClose:()=>{n(null)},onFileChange:n})]})},Z=(0,s(263).Z)(()=>{let e;let{user:t}=(0,j.a)(),{tagsWithData:s,loadingTags:i}=(0,o.e)(),[n,d]=(0,l.useState)("Tous les tags"),[c,u]=(0,l.useState)([]),[x,g]=(0,l.useState)([]),[f,p]=(0,l.useState)([]),[v,N]=(0,l.useState)(null),k=async()=>{if(t)try{let e=(0,y.JU)(b.db,"users",t.id),s=await (0,y.QT)(e);if(s.exists()){let e=s.data();e.favorites&&g(e.favorites)}}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des favoris :",e)}};(0,l.useEffect)(()=>{k()},[t]),(0,l.useEffect)(()=>{(async()=>{"Tous les fichiers"===n?u(await (0,w.qp)()):"Tous les tags"===n&&u([])})()},[n]);let S=c.map(e=>{var t;return{id:e.id,storagePath:e.storagePath,name:e.name,totalFiles:(null===(t=e.tags)||void 0===t?void 0:t.length)||1,type:e.storagePath.startsWith("videos/")?"video":"image",addBy:e.addBy,tags:e.tags}}),P=s.map(e=>({id:e.id,storagePath:e.data.lastAddedFileStoragePath,name:e.data.name,totalFiles:e.data.totalFiles||1,createdBy:e.data.createdBy,type:e.data.lastAddedFileStoragePath.startsWith("videos/")?"video":"image"})),C=x.map(e=>{var t;return{id:e.id,storagePath:e.storagePath,name:e.name,totalFiles:(null===(t=e.tags)||void 0===t?void 0:t.length)||1,type:e.storagePath.startsWith("videos/")?"video":"image",addBy:e.addBy,tags:e.tags}});return e="Fichiers favoris"===n?C:"Tous les fichiers"===n?S:c.length>0?S:P,(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(m,{greetingText:"Bienvenue, ".concat(null==t?void 0:t.pseudonym," !"),onSearchResults:u,selectedTags:f,setSelectedTags:p}),0===f.length&&(0,a.jsx)(h.Z,{categories:["Tous les tags","Tous les fichiers","Fichiers favoris"],selectedCategory:n,onCategorySelect:d}),(0,a.jsx)("div",{className:"min-h-screen bg-dark1",children:0===c.length&&f.length>0?(0,a.jsx)("div",{className:"flex justify-center items-center h-96",children:(0,a.jsx)("p",{className:"text-white text-lg",children:"Aucun fichier trouv\xe9 pour les tags s\xe9lectionn\xe9s"})}):(0,a.jsx)(E,{files:e,isTagView:"Tous les tags"===n&&0===c.length&&0===f.length,onTagClick:e=>p([e]),onFileClick:e=>N(e)},n+c.length)}),null!==v&&(0,a.jsx)(T,{files:e,currentIndex:v,onClose:()=>N(null),onFileChange:t=>{0===e.filter((e,s)=>s!==t).length?N(null):N(e=>e?e-1:null)}})]})})},2549:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=e=>{let{categories:t,selectedCategory:s,onCategorySelect:l}=e;return(0,a.jsxs)("div",{className:"bg-dark1 p-4 sm:p-8 md:p-16 md:pb-0",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white mb-4",children:s}),(0,a.jsx)("div",{className:"flex space-x-2 sm:space-x-4 overflow-x-auto",children:t.map(e=>(0,a.jsx)("button",{onClick:()=>l(e),className:"px-3 py-1 sm:px-4 sm:py-2 rounded-md text-sm sm:text-md md:text-lg transition duration-150 ease-in-out ".concat(s===e?"bg-dark3 text-white":"bg-transparent text-gray-400 opacity-80"," hover:bg-dark2 hover:text-white"),children:e},e))})]})}}},function(e){e.O(0,[358,691,697,65,453,325,971,23,744],function(){return e(e.s=8861)}),_N_E=e.O()}]);