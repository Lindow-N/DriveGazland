(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{560:function(e,t,a){Promise.resolve().then(a.bind(a,7734))},7734:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(7437),s=a(2265),o=a(8746),l=a(8872);a(2392);var n=a(3390),i=a(263),d=a(4364),c=a(3215),u=a(9842),m=a(3908);let h=m.db,g=async(e,t,a)=>{console.log(t,"storagePath","tagsServices.js");let r=(0,u.JU)(h,"tags",e),s=await (0,u.QT)(r);if(s.exists()){let e=s.data();await (0,u.pl)(r,{...e,totalFiles:e.totalFiles+1,lastAddedFileStoragePath:t},{merge:!0})}else await (0,u.pl)(r,{name:e,totalFiles:1,lastAddedFileStoragePath:t,createdBy:a.id,createdAt:new Date})};var x=a(7453);let f=async(e,t)=>{let a=(0,u.JU)(m.db,"users",e),r=await (0,u.QT)(a);if(r.exists()){let e=r.data(),s=(e.totalFileUploads||0)+1,o=e.recentFiles||[];o.unshift(t),o.length>3&&(o=o.slice(0,3)),await (0,u.r7)(a,{totalFileUploads:s,recentFiles:o})}else throw Error("Utilisateur non trouv\xe9")};var p=a(8786),b=a(2126),w=a(4768),v=(0,i.Z)(()=>{let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(""),[u,m]=(0,s.useState)([]),[h,v]=(0,s.useState)(0),[y,j]=(0,s.useState)(!1),[N,P]=(0,s.useState)(!1),[k,F]=(0,s.useState)(0),{user:E}=(0,x.a)(),{tags:C}=(0,p.e)(),S=a=>{if(""===a.trim())return;let r=[...e];r[h].tags=(0,d.Pn)(r[h].tags,a),t(r),i(""),m([])},A=a=>{let r=[...e];r[h].tags=r[h].tags.filter(e=>e!==a),t(r)},{getRootProps:U,getInputProps:_}=(0,o.uI)({onDrop:e=>{let a=e.map(e=>({id:e.name+Date.now(),file:e,preview:URL.createObjectURL(e),tags:[]}));t(e=>[...e,...a]),j(!1)},onDragEnter:()=>j(!0),onDragLeave:()=>j(!1)}),D=async()=>{P(!0),F(0);try{let a=e[h],r=(0,c.c)(a.file,a.file.type.startsWith("image")?"image":"video",a.tags,E,e=>F(e)),s=await r;for(let e of a.tags)await g(e,s,E);await f(null==E?void 0:E.id,s),(0,b.XA)(),h+1<e.length?v(h+1):(t([]),v(0)),i(""),F(100)}catch(e){console.error("Erreur lors de l'upload :",e),(0,b.Eo)("Erreur lors de l'upload")}finally{P(!1)}};return(0,r.jsx)(n.Z,{children:(0,r.jsxs)("div",{className:"bg-dark1 min-h-screen p-8 pb-32 lg:pb-8 ",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-white mb-6 font-title lg:ml-0 ml-6",children:"Ajouter un M\xe9dia"}),(0,r.jsxs)("div",{...U(),className:"border-2 border-dashed p-8 rounded-md flex justify-center items-center cursor-pointer transition-colors duration-200 ".concat(y?"border-greenPrimary bg-dark3":"border-gray-500 bg-dark2"),children:[(0,r.jsx)("input",{..._()}),(0,r.jsx)("p",{className:"text-gray-400 font-body",children:"Glissez et d\xe9posez des fichiers ici, ou cliquez pour s\xe9lectionner"})]}),e.length>0&&(0,r.jsxs)("div",{className:"mt-6 max-w-lg mx-auto",children:[(0,r.jsxs)("div",{className:"text-white mb-4 font-bold font-subtitle text-center",children:[h+1," sur ",e.length]}),(0,r.jsxs)("div",{className:"bg-dark2 p-4 rounded-lg shadow-md w-full",children:[e[h].file.type.startsWith("video")?(0,r.jsx)("video",{src:e[h].preview,controls:!0,className:"w-full max-w-[500px] max-h-[400px] h-auto object-contain rounded-md mb-4"}):(0,r.jsx)(l.Z,{children:(0,r.jsx)("img",{src:e[h].preview,alt:"Image active",className:"w-full max-w-[500px] max-h-[400px] h-auto object-contain rounded-md mb-4 cursor-pointer"})}),(0,r.jsx)("div",{className:"text-white font-bold font-subtitle mb-2 text-center",children:e[h].tags.join(" ")})]}),N?(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:(0,r.jsx)("div",{className:"bg-greenPrimary h-2.5 rounded-full",style:{width:"".concat(k,"%")}})}),(0,r.jsxs)("p",{className:"text-center text-white mt-2 font-body",children:[k,"%"]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center mt-4 w-full relative",children:[(0,r.jsx)("input",{type:"text",value:a,onChange:e=>{let t=e.target.value.toLowerCase();i(t),t.length>0?m(C.filter(e=>e.toLowerCase().startsWith(t))):m([])},placeholder:"Ajouter un tag",className:"bg-dark3 text-white p-2 rounded-md focus:outline-none font-body w-full mr-2"}),(0,r.jsx)("button",{onClick:()=>S(a),className:"bg-greenPrimary text-white px-3 py-2 rounded-md font-body ".concat(""===a.trim()?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:""===a.trim(),children:"Ajouter"}),u.length>0&&(0,r.jsx)("div",{className:"absolute top-full mt-2 w-full bg-dark3 rounded-md shadow-lg max-h-28 overflow-y-auto z-10",children:u.map(e=>(0,r.jsx)("div",{className:"p-2 hover:bg-dark2 cursor-pointer text-white",onClick:()=>S(e),children:e},e))})]}),(0,r.jsx)("div",{className:"flex flex-wrap mt-4",children:e[h].tags.map((e,t)=>(0,r.jsx)(w.Z,{text:e,onRemove:()=>A(e)},t))}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{onClick:D,className:"bg-greenPrimary text-white px-4 py-2 rounded-md font-body w-full ".concat(0===e[h].tags.length?"opacity-50 cursor-not-allowed":"hover:bg-green-600"),disabled:0===e[h].tags.length,children:"Upload Fichier"})})]})]})]})})})},4768:function(e,t,a){"use strict";var r=a(7437);a(2265),t.Z=e=>{let{text:t,onRemove:a}=e;return(0,r.jsxs)("span",{className:"bg-greenPrimary text-white px-4 py-2 rounded-lg mr-2 mb-2 font-body flex items-center",children:[t,(0,r.jsx)("button",{onClick:a,className:"ml-4 text-black hover:text-red-500 text-2xl font-bold focus:outline-none",children:"\xd7"})]})}},3215:function(e,t,a){"use strict";a.d(t,{c:function(){return i},m:function(){return d}});var r=a(9854),s=a(9842),o=a(3908);let l=(0,r.cF)(),n=o.db,i=async(e,t,a,o,i)=>{if(!e||!e.name)throw Error("Le fichier est invalide ou manquant.");let d=a.join("_").toLowerCase(),c=e.name.split(".").pop(),u="".concat("image"===t?"images":"videos","/").concat(d,"_").concat(Date.now(),".").concat(c),m=(0,r.iH)(l,u),h=(0,r.B0)(m,e);return new Promise((e,r)=>{h.on("state_changed",e=>{let t=Math.round(e.bytesTransferred/e.totalBytes*100);i&&i(t)},e=>{r(e)},async()=>{try{await (0,s.ET)((0,s.hJ)(n,"files"),{name:"".concat(d,".").concat(c),storagePath:u,type:t,tags:a,addBy:o.id,createdAt:new Date}),console.log("Fichier ajout\xe9 avec succ\xe8s dans Firestore avec storagePath."),e(u)}catch(e){console.error("Erreur lors de l'ajout du fichier \xe0 Firestore :",e),r(e)}})})},d=async(e,t)=>{console.log(t,"currentFile");try{let a=(0,s.JU)(o.db,"users",e.id);if(!e.favorites.some(e=>e.storagePath===t.storagePath))return await (0,s.r7)(a,{favorites:(0,s.vr)({id:t.id,storagePath:t.storagePath,name:t.name,type:t.type,addBy:t.addBy,tags:t.tags})}),!0;{let r=e.favorites.find(e=>e.storagePath===t.storagePath);return r&&await (0,s.r7)(a,{favorites:(0,s.Ab)(r)}),!1}}catch(e){return console.error("Erreur lors de la mise \xe0 jour des favoris :",e),!1}}}},function(e){e.O(0,[43,358,691,697,239,746,20,971,23,744],function(){return e(e.s=560)}),_N_E=e.O()}]);